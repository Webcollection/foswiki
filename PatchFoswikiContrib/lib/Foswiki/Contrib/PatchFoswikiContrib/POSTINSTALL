
my $this = shift;

foreach my $key ( grep /^working.*\.patch/, keys %{ $this->{_manifest}} ) {

    my $patchFile = Foswiki::Configure::Util::mapTarget( $this->{_root}, $key );

    print STDERR "Mapped $key to $patchFile\n";

    require Foswiki::Configure::PatchFile;
    my %result = Foswiki::Configure::PatchFile::parsePatch( $patchFile );

    foreach my $key ( keys %result ) {
        print STDERR "Processing $key\n";
        next if ( $key eq 'summary' );

        my $file = Foswiki::Configure::Util::mapTarget( $this->{_root}, $key );

        print STDERR "Patching $file with (($result{$key}))\n";

        my $rc = Foswiki::Configure::PatchFile::updateFile( $file, $result{$key} );

        die if $rc;

    }

}

